<style>
/* HIDE RADIO */
/*
[type=radio] { 
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}
/*

/* IMAGE STYLES */
[type=radio] + div {
  cursor: pointer;
}

/* CHECKED STYLES */
/*
[type=radio]:checked + div {
  outline: 3px solid #f00;
  height: 287px;
}
/*

/*
[type=radio]:checked + div {
  outline: 3px solid #f00;
  height: 528px;
}
*/
.pad-td {
    padding-right: 20px; /* Add some padding */
    /* Add any other custom styles you want */
}

.face-img {
  width: 256px;
  max-width: 256px;
  padding: 4px
}

.face-vid {
  width: 256px;
  max-width: 256px;
  padding: 4px
}
.face-table thead{
  font-size: 1.5rem;
}
.empty-space {
    width: 256px;
    height: 256px;
    background-color: #ffffff; /* Optional: Set a background color for visualization */
    display: inline-block;
    padding: 4px;

}
</style>

<form action="/submit" method="post">

  <div style="background-color:azure" header="Instructions">
      <h3> For user study & research purposes only.</h3>
      <p>Which of the images below best accomplishes the following task?: <b>
        Producing the most photorealistic face relighting using target lighting.</b></p>
      <p>Step by step guide : </p>
      <ol>
        <li> Look at the "Target lighting" image at the bottom left as a reference for lighting conditions.</li>
        <li> Compare the relit images on the right side (Relit#1, Relit#2, etc.) to the "Target lighting".</li>
        <li> Select the image that you think best matches the lighting of the "Target lighting" while still maintaining the photorealism of the face.</li>
        <li> Click on the image you choose. Ensure your answer is confirmed by a red border around the selected image.</li>
        <li> Click the submit button once you have made your choice.</li>
      </ol>
  </div>
  <div style="text-align:center; width:100%;">
      <p>Which of the images best accomplishes the following task?:  <b>
        Producing the most photorealistic face relighting using target lighting.</b> </p>
  </div>

    <!-- <table class="face-table" style="margin-left: auto;margin-right: auto;">
    <thead>
      <tr>
        <td style="width: 256px;">Softening#1</td>
        <td style="width: 256px;">Original image</td>
        <td style="width: 256px;">Softening#2</td>
       </tr>
    </thead>
    </table> -->
  </div>
  <div style="text-align:center;width:100%" id="result-panel"></div>
  <script>
    var n = 9; // Set n to the desired number of elements
    var max_pairs = 3;
    //var subjects = Array.from({ length: n }, () => `pair${Math.floor(Math.random() * max_pairs) + 1}`);
  	var subjects = Array.from({ length: max_pairs }, (_, i) => `pair${i + 1}`);
    var result_panel = document.getElementById("result-panel");
    var output_html = ""
    subjects.forEach(sj_name => {
      var orders = ["difareli_canny=153to204", 
                    "total_relighting",
                    "hou21_shadowm",
                    "hou22_geom",
                  ];
      orders = orders.map(value => ({ value, sort: Math.random() })).sort((a, b) => a.sort - b.sort).map(({ value }) => value);
      orders = ["input"].concat(orders) // ['input'] are always the first element;
      console.log(orders)
      // NOTE: Multiple questions
      output_html += 
      `
      <table class="face-table" style="margin-left: auto;margin-right: auto;">
      <thead>
      </thead>
      `
      // Showing the input-target-sh
      const input_img_p = `./dat/randomly_for_mturk/eval_pairs/${sj_name}/input_${sj_name}.png`;
      const target_img_p = `./dat/randomly_for_mturk/eval_pairs/${sj_name}/target_${sj_name}.jpg`;
      const sh_img_p = `./dat/randomly_for_mturk/eval_pairs/${sj_name}/sh_${sj_name}.jpg`;
      
      var source = [input_img_p, target_img_p, sh_img_p];
      var source_lab = ["Input Image", "Target Lighting", "Target SH"];
      var show_source = `<td colspan="${orders.length-1}" style="text-align: center;">`;  // Open the td tag
      
      for (let i = 0; i < 3; i++) {
        // Add each image and label wrapped in a div with display inline-block to make them appear in line
        show_source += `<div style="display: inline-block;">
                          <span style="font-size: 20px; display: block;">${source_lab[i]}</span>
                          <img src="${source[i]}" style="display: block;" class="face-img"/>
                        </div>`;
      }
      show_source += `</td>`; // Close the td tag
      output_html += `<tr>${show_source}</tr>`;

      for (let i = 0; i < orders.length; i++) {
          const method_name = orders[i];
          const img_tmp_path = `./dat/randomly_for_mturk/eval_pairs/${sj_name}/${method_name}_${sj_name}.png`;

          if (method_name !== "input") {
              output_html += `<td>`;
              output_html += `
                      <div class="mint">
                          <span style="font-size: 20px;">Relit#${i}</span><br>
                          <img src="${img_tmp_path}" class="face-img"/>
                      </div>
              `;
              output_html += `</td>`;
          }
      }

      var questions = ["Most Accurate", "Most Realistic"]; // Add more questions as needed
      var questions_label = ["accuracy", "realism"]

      
      for (let q = 0; q < questions.length; q++) {
          output_html += `<tr>`; // Start the row before the loop to have all questions in the same row
          const question = questions[q];

          // Add a label for the question
          output_html += `<td colspan=${orders.length} style="text-align: center;">${question}:`;
          
          // Create the radio buttons for each question
          for (let i = 0; i < orders.length; i++) {
              const method_name = orders[i];
              if (method_name !== "input") {
                  output_html += `
                      <input type="radio" id="${method_name}_${question}_${sj_name}" name="${question}_${sj_name}" value="${method_name}">
                      <label for="${method_name}_${question}_${sj_name}">Relit#${i}</label>
                  `;
              }
          }

          // Close the cell for the question
          output_html += `</td></tr>`;
      }

      output_html += `</tr>`; // End the row after all questions have been added

      output_html += `</table>`
      output_html += "Click on the <b>Best</b> image";
      output_html += '<hr>'
    })

    result_panel.innerHTML  = output_html;
  </script>
  <div style="text-align:center;width:100%">
    <h2>Please check you've answered all the question then click submit.</h2>
    <input style="font-size:24px" type="button" value="Submit" id="submitbutton" onclick="submitForm()"></input>
  </div>
  <script>
    function submitForm(event) {
      var orders = ["difareli_canny=153to204", 
                    "total_relighting",
                    "hou21_shadowm",
                    "hou22_geom",
                  ];
      var radios = document.querySelectorAll('input[type="radio"]');
      var checked = [];
      console.log("[#] ORDERS : ");
      console.log(orders.length)
      console.log("[#] RADIO : ");
      console.log(radios.length)
      for (var i = 0; i < radios.length; i++) {
        checked.push(radios[i].checked)
      }
      console.log("[#] CHECK STATUS : ");
      console.log(checked);
      console.log(checked.length);
      // Slice into 2
      const valid_ans = [];
      for (let i = 0; i < checked.length; i += (orders.length)) {
        valid_ans.push(checked.slice(i, (i + orders.length)));
      }
      console.log("[#] SLICE : ")
      console.log(valid_ans)
      
      // Check each radio
      final_valid_ans = []
      for (let i = 0; i < valid_ans.length; i++) {
        final_valid_ans.push(!valid_ans[i].every(element => element === false));
      }
      console.log("[#] Check each radio : ")
      console.log(final_valid_ans);
      final_valid_ans = final_valid_ans.every(element => element === true);
      console.log("[#] Final status : ")
      console.log(final_valid_ans);


      if (!final_valid_ans) {
        alert("[#] Please answer all of the question...")
      }

      else {
        var output = {};
        subjects.forEach(sj_name => {
          var ans = document.querySelector(`input[name=${sj_name}]:checked`).value;
          output[sj_name] = ans
        })

        console.log("FROM HTML : " + JSON.stringify(output));
          var xhr = new XMLHttpRequest();
          xhr.open("POST", "/submit", true);
          xhr.setRequestHeader("Content-Type", "application/json");
          xhr.onreadystatechange = function() {
            if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
              var response = JSON.parse(this.responseText);
              console.log("Response received: " + response.message);
            }
          };
        xhr.send(JSON.stringify(output));
        var button = document.getElementById(`submitbutton`);
        button.style.backgroundColor = "transparent";
        button.style.borderRadius = "0";
        button.disabled = true;
        button.value = "Submitted"
        alert("[#] Submitted, Thank you for your time...");
      }
    }
  </script>
</form>