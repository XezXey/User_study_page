<style>
  /* HIDE RADIO */
  /*
[type=radio] { 
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}
/*

/* IMAGE STYLES */
  [type=radio]+div {
    cursor: pointer;
    transform: scale(5);
  }

  /* CHECKED STYLES */
  /*
[type=radio]:checked + div {
  outline: 3px solid #f00;
  height: 287px;
}
/*

/*
[type=radio]:checked + div {
  outline: 3px solid #f00;
  height: 528px;
}
*/
  .pad-td {
    padding-right: 20px;
    /* Add some padding */
    /* Add any other custom styles you want */
  }

  .face-img {
    width: 256px;
    max-width: 256px;
    padding: 4px
  }

  /*
.face-table thead{
  font-size: 1.5rem;
}
*/
  body {
    font-family: 'Google Sans', sans-serif;
    padding-bottom: 50px;
  }

  .instruction {
    font-size: 18px;
  }

  .title {
    font-size: 35px;
  }

  br.large {
    line-height: 22px;
  }

  .crit {
    background-color: #fff1f1;
    padding: 5px;
    margin: 5px;
  }

  table.result td {
    width: 256px;
    text-align: center;
    vertical-align: middle;
    padding: 5px;
    margin: 0px;
    /* margin-bottom: 10px; */
  }

  td {
    text-align: center;
  }

  table {
    margin-left: auto;
    margin-right: auto;
    border-spacing: 0px;
  }

  .sticky-div {
    position: -webkit-sticky;
    /* For Safari */
    position: sticky;
    top: 0;
    /* Distance from the top */
    background-color: white;
  }

  .questiontext {
    font-size: 22px;
    text-align: center;
  }

  .qtext {
    font-size: 22px;
  }

  .firsttd {
    text-align: left !important;
    padding: 10px !important;
  }
  h1 {
    text-align: center;
  }
  .template {
    display: none;
  }

</style>

<link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">


<form action="/submit" method="post">
  <div style="background-color:azure; text-align:left; margin-left: auto; margin-right: auto;" header="Instructions">
    <h2 class="title">Face Relighting Evaluation</h2>
    <span class="instruction">
      <p>This webpage contains 5 tasks, each with 2 questions (10 questions in total). </p>

      <p>In each task, you will assess which result most convincingly relights an input face image (A) to match a target
        lighting condition (B). The target lighting is illustrated using two visuals: </p>
      <ol class="instruction">
        <li>A rendering of a diffuse ball under the target lighting condition.</li>
        <li>An image of another person under the target lighting condition.</li>
      </ol>
      <p>
        In other words, you will determine which result makes the input person appear as if they are in the same
        environment as
        the other person in the target lighting.
        Then, you will choose the most convincing result based on two different criteria:</p>
      <p class="crit"><b>Criterion 1:</b> Considering only the face.</p>
      <p class="crit"><b>Criterion 2:</b> Considering the entire person (face, hair, body, and clothing), <em>excluding
          the background</em>.</p>

      <p>
        To make a selection, click either on the image itself or the radio button below the image. Once done, please
        click 'Submit' at the bottom of this page.
      </p>
    </span>
  </div>
  <br>
  <hr><br>
  <div id="main">
    <div class="task template">
      <!-- <div class="sticky-div"> -->
      <h1>Task {num}</h1>
      <p class="questiontext">
        Which of these results most convincingly relights the input face image to match the target lighting?
      </p>
      <!-- </div> -->
      <table class="result">
        <tr>
          <td></td>
          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/input_pair1.png" class="face-img"><br>
            <span>(A) Input Image</span>
          </td>
          <td style="" colspan="3">
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/target_pair1.jpg" class="face-img">
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/sh_pair1.jpg" class="face-img"><br>
            <span>(B) Target Lighting</span>
          </td>
        </tr>
        <tr style="background-color: #EEEEEE;">
          <td class="firsttd"><span class="qtext">Question 1:</span><br> Considering only the face region</td>
          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/hou22_geom_pair1_wm_facial.png" class="face-img">
            <input type="radio" id="q1a1" name="q1" value="a1" /> <label for="a1">Result 1</label>
          </td>
          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/difareli_canny=153to204_pair1_wm_facial.png"
              class="face-img">
            <input type="radio" id="q1a2" name="q1" value="a2" /> <label for="a2">Result 2</label>
          </td>

          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/hou21_shadowm_pair1_wm_facial.png" class="face-img">
            <input type="radio" id="q1a3" name="q1" value="a3" /> <label for="a3">Result 3</label>
          </td>

          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/total_relighting_pair1_wm_facial.png" class="face-img">
            <input type="radio" id="q1a4" name="q1" value="a4" /> <label for="a4">Result 4</label>
          </td>
        </tr>
        <tr>
          <td style="height: 10px;"></td>
        </t>
        <tr style="background-color: #EEEEEE;">
          <td class="firsttd"><span class="qtext">Question 2:</span><br> Considering the entire person (face, hair,
            body, and clothing), <em>excluding
              the background</em></td>
          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/hou22_geom_pair1_wm_bg.png" class="face-img">
            <input type="radio" id="q2a1" name="q2" value="a1" /> <label for="a1">Result 1</label>
          </td>
          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/difareli_canny=153to204_pair1_wm_bg.png"
              class="face-img">
            <input type="radio" id="q2a2" name="q2" value="a2" /> <label for="a2">Result 2</label>
          </td>

          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/hou21_shadowm_pair1_wm_bg.png" class="face-img">
            <input type="radio" id="q2a3" name="q2" value="a3" /> <label for="a3">Result 3</label>
          </td>

          <td>
            <img src="./dat/randomly_for_mturk/eval_pairs/pair1/total_relighting_pair1_wm_bg.png" class="face-img">
            <input type="radio" id="q2a4" name="q2" value="a4" /> <label for="a4">Result 4</label>
          </td>
        </tr>
      </table>
      </table>
    <hr>
    </div>
  </div>
  <div style="text-align:center;width:100%" id="result-panel"></div>
  <script>
    var n = 5; // Set n to the desired number of elements

    for (var i = 0; i < n; i++) {
      var div = document.createElement('div');
      div.className = 'task';
      div.innerHTML = document.querySelector('.template').innerHTML.replace(/{num}/g, i + 1);
      div.innerHTML = div.innerHTML.replace(/pair1/g, "pair" + (i + 1));
      div.innerHTML = div.innerHTML.replace(/Question 1/g, "Question " + (2*i + 1));
      div.innerHTML = div.innerHTML.replace(/Question 2/g, "Question " + (2*i + 2));
      document.getElementById('main').appendChild(div);
    }
     
  </script>

  <script>
    function submitForm(event) {
      var orders = ["difareli_canny=153to204",
        "total_relighting",
        "hou21_shadowm",
        "hou22_geom",
      ];
      var radios = document.querySelectorAll('input[type="radio"]');
      var checked = [];
      console.log("[#] ORDERS : ");
      console.log(orders.length)
      console.log("[#] RADIO : ");
      console.log(radios.length)
      for (var i = 0; i < radios.length; i++) {
        checked.push(radios[i].checked)
      }
      console.log("[#] CHECK STATUS : ");
      console.log(checked);
      console.log(checked.length);
      // Slice into 2
      const valid_ans = [];
      for (let i = 0; i < checked.length; i += (orders.length)) {
        valid_ans.push(checked.slice(i, (i + orders.length)));
      }
      console.log("[#] SLICE : ")
      console.log(valid_ans)

      // Check each radio
      final_valid_ans = []
      for (let i = 0; i < valid_ans.length; i++) {
        final_valid_ans.push(!valid_ans[i].every(element => element === false));
      }
      console.log("[#] Check each radio : ")
      console.log(final_valid_ans);
      final_valid_ans = final_valid_ans.every(element => element === true);
      console.log("[#] Final status : ")
      console.log(final_valid_ans);


      if (!final_valid_ans) {
        alert("[#] Please answer all of the question...")
      }

      else {
        var output = {};
        subjects.forEach(sj_name => {
          output[sj_name] = {};
          testing_scenario.forEach(scenario => {
            output[sj_name][scenario] = {};
            questions.forEach(question => {
              // Construct the name attribute for the radio group
              let radioGroupName = `${scenario}_${question}_${sj_name}`;
              let radioButton = document.querySelector(`input[name="${radioGroupName}"]:checked`);
              let ans = radioButton.value;
              output[sj_name][scenario][question] = ans;
            });
          });
        });

        console.log("FROM HTML : " + JSON.stringify(output));
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/submit", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
          if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
            var response = JSON.parse(this.responseText);
            console.log("Response received: " + response.message);
          }
        };
        xhr.send(JSON.stringify(output));
        var button = document.getElementById(`submitbutton`);
        button.style.backgroundColor = "transparent";
        button.style.borderRadius = "0";
        button.disabled = true;
        button.value = "Submitted"
        alert("[#] Submitted, Thank you for your time...");
      }
    }
  </script>
</form>
