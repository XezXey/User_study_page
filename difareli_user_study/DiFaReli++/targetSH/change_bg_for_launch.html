<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<style type="text/css">/* HIDE RADIO */
  /* HIDE RADIO */
  /*
[type=radio] { 
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}
/*

/* IMAGE STYLES */
  [type=radio]+div {
    cursor: pointer;
    transform: scale(5);
  }

  /* CHECKED STYLES */
  /*
[type=radio]:checked + div {
  outline: 3px solid #f00;
  height: 287px;
}
/*

/*
[type=radio]:checked + div {
  outline: 3px solid #f00;
  height: 528px;
}
*/
  .pad-td {
    padding-right: 20px;
    /* Add some padding */
    /* Add any other custom styles you want */
  }

  .face-img {
    width: 256px;
    max-width: 256px;
    padding: 4px
  }

  /*
.face-table thead{
  font-size: 1.5rem;
}
*/
  body {
    font-family: 'Google Sans', sans-serif;
    padding-bottom: 50px;
  }

  .instruction {
    font-size: 18px;
  }

  .title {
    font-size: 35px;
  }

  br.large {
    line-height: 22px;
  }

  .crit {
    background-color: #fff1f1;
    padding: 5px;
    margin: 5px;
  }

  table.result td {
    width: 256px;
    text-align: center;
    vertical-align: middle;
    padding: 5px;
    margin: 0px;
    /* margin-bottom: 10px; */
  }

  td {
    text-align: center;
  }

  table {
    margin-left: auto;
    margin-right: auto;
    border-spacing: 0px;
  }

  .sticky-div {
    position: -webkit-sticky;
    /* For Safari */
    position: sticky;
    top: 0;
    /* Distance from the top */
    background-color: white;
  }

  .questiontext {
    font-size: 22px;
    text-align: center;
  }

  .qtext {
    font-size: 22px;
  }

  .firsttd {
    text-align: left !important;
    padding: 10px !important;
  }

  h1 {
    text-align: center;
  }

  .template,
  .tdtemplate,
  .tdtemplate2 {
    display: none;
  }

  .caption {
    font-size: 20px;
  }

  input[type="radio"],
  .choice {
    cursor: pointer;
  }

  input[type="radio"] {
    margin-top: 15px;
  }

  .caption {
    cursor: pointer;
  }

  label.caption {
    padding-top: 10px;
  }
</style>

<!-- <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet"> -->
<link href="https://fonts.googleapis.com" rel="preconnect" />
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
<!-- <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
<link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet" />

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" /><!-- <form action="/submit" method="post"> --><crowd-form>
<!-- <form action="/submit" method="post"> -->

<div header="Instructions" style="background-color:azure; text-align:left; margin-left: auto; margin-right: auto;">
    <h2 class="title">Face Relighting Evaluation</h2>
    <span class="instruction">
      <p>This webpage contains 10 tasks, each with 2 questions (20 questions in total). </p>

      <p>In each task, you will assess which result most convincingly relights an input face image (A) to match a target
        lighting condition (B). The target lighting is illustrated using two visuals: </p>
      <ol class="instruction">
        <li>An image of another person under the target lighting condition.</li>
        <li>A rendering of a diffuse ball under the target lighting condition.</li>
      </ol>
      <p>
        In other words, you will determine which result makes the input person appear as if they are in the same
        environment as
        the other person in the target lighting.
        Then, you will choose the most convincing result based on two different criteria:</p>
      <p class="crit"><b>Criterion 1:</b> Considering only the face.</p>
      <p class="crit"><b>Criterion 2:</b> Considering the entire person (face, hair, body, and clothing), <em>excluding
          the background</em>.</p>

      <p>
        To make a selection, click either on the image itself or the radio button below the image. Once done, please
        click 'Submit' at the bottom of this page.
      </p>
    </span>
  </div>
  <br>
  <hr><br>
  <div id="main">
    <div class="task template">
      <!-- <div class="sticky-div"> -->
      <h1>Task {num}</h1>
      <p class="questiontext">
        Which of these results most convincingly relights the input face image to match the target lighting?
      </p>
      <!-- </div> -->
      <table class="result">
        <tr>
          <td></td>
          <td>
            <img src="https://raw.githubusercontent.com/XezXey/User_study_page/refs/heads/main/difareli_user_study/DiFaReli%2B%2B/dat/randomly_for_mturk/user_study_targetSH_pairs/pair{p}/input_pair{p}.jpg" class="face-img"><br>
            <!-- <img src="./dat/randomly_for_mturk/eval_pairs/pair{p}/input_pair{p}.png" class="face-img"><br> -->
            <!-- <img src="./dat/randomly_for_mturk/pairs_for_ui_figure/pair{p}/input_pair{p}.png" class="face-img"><br> -->
            <span class="caption">(A) Input Image</span>
          </td>
          <td style="" colspan="3">
            <img src="https://raw.githubusercontent.com/XezXey/User_study_page/refs/heads/main/difareli_user_study/DiFaReli%2B%2B/dat/randomly_for_mturk/user_study_targetSH_pairs/pair{p}/target_pair{p}.jpg" class="face-img">
            <img src="https://raw.githubusercontent.com/XezXey/User_study_page/refs/heads/main/difareli_user_study/DiFaReli%2B%2B/dat/randomly_for_mturk/user_study_targetSH_pairs/pair{p}/sh_pair{p}.jpg" class="face-img"><br>

            <!-- <img src="./dat/randomly_for_mturk/eval_pairs/pair{p}/target_pair{p}.jpg" class="face-img">
            <img src="./dat/randomly_for_mturk/eval_pairs/pair{p}/sh_pair{p}.jpg" class="face-img"><br> -->

            <!-- <img src="./dat/randomly_for_mturk/pairs_for_ui_figure/pair{p}/target_pair{p}.jpg" class="face-img">
            <img src="./dat/randomly_for_mturk/pairs_for_ui_figure/pair{p}/sh_pair{p}.jpg" class="face-img"><br> -->
            <span class="caption">(B) Target Lighting</span>
          </td>
        </tr>
        <tr style="background-color: #EEEEEE;">
          <td class="firsttd"><span class="qtext">Question {q1}:</span><br> Considering only the face region</td>
          <td class="tdtemplate">
            <!-- <img src="./dat/randomly_for_mturk/pairs_for_ui_figure/pair{p}/{name}_pair{p}_wm_facial.png"
             onclick="this.nextElementSibling.click();" class="fg-img choice" /> -->

            <img src="https://raw.githubusercontent.com/XezXey/User_study_page/refs/heads/main/difareli_user_study/DiFaReli%2B%2B/dat/randomly_for_mturk/user_study_targetSH_pairs/pair{p}/{name}_pair{p}_wm_facial.png"
             onclick="this.nextElementSibling.click();" class="fg-img choice" />

            <input type="radio" id="q{qnum}a{anum}" name="q{qnum}_p{p}" value="a{anum}_{name}" />
            <label for="q{qnum}a{anum}" class="caption choice">Result {anum}</label>
          </td>
        </tr>
        <tr>
          <td style="height: 10px;"></td>
        </tr>
        <tr style="background-color: #EEEEEE;">
          <td class="firsttd"><span class="qtext">Question {q2}:</span><br> Considering the entire person (face, hair,
            body, and clothing), <em>excluding
              the background</em>
          </td>
          <td class="tdtemplate2">
            <!-- <img src="./dat/randomly_for_mturk/pairs_for_ui_figure/pair{p}/{name}_pair{p}_wm_bg.png" 
            onclick="this.nextElementSibling.click();" class="bg-img choice"/> -->

            <img src="https://raw.githubusercontent.com/XezXey/User_study_page/refs/heads/main/difareli_user_study/DiFaReli%2B%2B/dat/randomly_for_mturk/user_study_targetSH_pairs/pair{p}/{name}_pair{p}_wm_bg.png" 
            onclick="this.nextElementSibling.click();" class="bg-img choice"/>
            <input type="radio" id="q{qnum}a{anum}" name="q{qnum}_p{p}" value="a{anum}_{name}" /> 
            <label for="q{qnum}a{anum}" class="caption choice">Result {anum}</label>
          </td>
        </tr>
      </table>
      </table>
      <hr>
    </div>
  </div>
  <div style="text-align:center;width:100%" id="result-panel"></div>

<div id="result-panel" style="text-align:center;width:100%">&nbsp;</div>
  <script>
    var n = 10; // Set n to the desired number of elements

    const data = "${sj_name}";
    let pairs = data.split("#");

    for (var i = 0; i < n; i++) {
      var div = document.querySelector('.template').cloneNode(true);
      div.className = 'task';

      let tem = div.innerHTML;
      tem = tem.replace(/{num}/g, i + 1);
      tem = tem.replace(/{p}/g, pairs[i].slice(4));
      tem = tem.replace(/{q1}/g, 2 * i + 1);
      tem = tem.replace(/{q2}/g, 2 * i + 2);
      div.innerHTML = tem;

      let listimages = ["hou22_geom", "difareli++", "hou21_shadowm", "ic_light", "total_relighting"];
      listimages = listimages.sort(() => Math.random() - 0.5);
      for (let j = 0; j < 5; j++) {
        function replace(templatename, q) {
          let template = div.querySelector('.' + templatename);
          let newtd = template.cloneNode(true);
          newtd.className = "";

          let str = newtd.innerHTML;
          str = str.replace(/{p}/g, i + 1);
          str = str.replace(/{name}/g, listimages[j]);
          str = str.replace(/{qnum}/g, q);
          str = str.replace(/{anum}/g, j + 1);
          newtd.innerHTML = str;
          template.parentNode.appendChild(newtd);
        }

        replace("tdtemplate", 2 * i + 1);
        replace("tdtemplate2", 2 * i + 2);
      }

      document.getElementById('main').appendChild(div);
    }

    window.onload = function () {
      var radios = document.querySelectorAll('input[type="radio"]');
      console.log("[#] RADIOACTIVE : ");
      console.log(radios.length);
      for (var i = 0; i < radios.length; i++) {
        radios[i].addEventListener('click', function () {
          var images = this.parentNode.parentNode.querySelectorAll('img');
          for (var j = 0; j < images.length; j++) {
            images[j].style.outline = "none";
          }
          this.previousElementSibling.style.outline = "4px solid #f00";
        });
      }
    }

    document.querySelector('crowd-form').onsubmit = function(e) {
      // Check the results here
      checked = [];
      n_choices = 5
      // Available task
      for (var i = 0; i < n; i++) {
        // Available questions
        for (var j = 0; j<2; j++){
          // Available choices
          for (let k = 0; k < n_choices; k++) {
            // Get the radio value
            checked.push(document.getElementById(`q${2*i+j+1}a${k+1}`).checked);
          }
        }
      }

      valid_ans = [];
      for (let i = 0; i < checked.length; i += n_choices) {
        valid_ans.push(checked.slice(i, (i + n_choices)).some(element => element === true));
      }

      final_valid_ans = valid_ans.every(element => element === true);
      
      if (!final_valid_ans) {
        alert("[#] Please answer all of the question before making a submission...")
        e.preventDefault();
      }
      else {
        alert("Thank you for your time...");
      }
  }
  </script>

</crowd-form>
<!-- </form> -->
